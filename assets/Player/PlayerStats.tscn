[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/Status/Poison.gd" type="Script" id=1]
[ext_resource path="res://assets/Status/Frenzy.gd" type="Script" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

var acceleration = 1600
var max_speed = 100
var speed_mod = 0 setget set_speed_mod
var attack_speed = 1.0 setget set_attack_speed
var roll_speed = 200
var shade_speed = 420
var friction = 800
var shade_friction = 1600

var max_health = 60 setget set_max_health
var health = 60 setget set_health

var endurance = 4 setget set_endurance
var max_stamina = 60 setget set_max_stamina
var stamina = max_stamina setget set_stamina

var strength = 4.0 setget set_strength
# var strength_mod = 0 setget set_strength_mod

var defense = 4.0 setget set_defense
var defense_mod = 0 setget set_defense_mod

var base_accuracy = 75
var dexterity = 4.0 setget set_dexterity

var speed = 4.0 setget set_speed
var iframes = 0.1 setget set_iframes

var max_charge = 100 setget set_max_charge
var charge = 0 setget set_charge

var max_charge_level = 2 setget set_max_charge_level
var charge_level = 0 setget set_charge_level

var experience_required = 100 setget set_max_experience
var experience = 82 setget set_experience
var level = 1 setget set_level
var experience_total = 82
var cash = 0 setget set_cash

var status = \"fine\" setget set_status
var sweating = false
var is_poisoned = false

var continue_count = 0

signal no_health
signal status_changed(value)
signal health_changed(value)
signal max_health_changed(value)
signal endurance_changed(value)
signal stamina_changed(value)
signal max_stamina_changed(value)
signal strength_changed(value)
# signal strength_mod_changed(value)
signal dexterity_changed(value)
signal defense_changed(value)
signal defense_mod_changed(value)
signal iframes_changed(value)
signal speed_changed(value)
signal attack_speed_changed(value)

signal max_charge_changed(value)
signal charge_changed(value)

signal max_charge_level_changed(value)
signal charge_level_changed(value)

signal experience_changed(value)
signal max_experience_changed(value)
signal level_changed(value)
signal cash_changed(value)

func _ready():
	self.acceleration = acceleration
	self.max_speed = max_speed
	self.speed_mod = speed_mod
	self.roll_speed = roll_speed
	self.shade_speed = shade_speed
	self.friction = friction
	self.shade_friction = shade_friction
	
	self.status = status
	self.health = health
	self.experience = experience_total
	self.strength = strength
	self.dexterity = dexterity
	self.defense = defense
	self.stamina = max_stamina
	self.iframes = iframes
	self.endurance = endurance
	self.speed = speed
	self.attack_speed = attack_speed
	self.cash = cash
	self.charge = charge
	self.charge_level = charge_level
	
func set_speed_mod(value):
	speed_mod = value
	
func set_status(value):
	status = value
	match status:
		\"fine\":
			speed_mod = 0
			$Poison.count = 0
		\"sweating\":
			sweating = true
		\"sweating_end\":
			sweating = false
		\"slow\":
			speed_mod = -max_speed/2
		\"default_speed\":
			speed_mod = 0
		\"poison\":
			$Poison.activate()
		\"poison_end\":
			print('poison ended.')
		\"frenzy\":
			$Frenzy.activate()
		\"frenzy_end\":
			print('frenzy ended.')
			
	emit_signal(\"status_changed\", status)

func set_max_health(value):
	max_health = value
	self.health = min(health, max_health)
	emit_signal(\"max_health_changed\", max_health)

func set_health(value):
	health = value
	health = clamp(value, 0, max_health)
	emit_signal(\"health_changed\", health) # every time the health is set, emits a signal \"health_changed\" along with an argument, our new health value
	if health <= 0:
		emit_signal(\"no_health\")
		
func set_endurance(value):
	endurance = value
	emit_signal(\"endurance_changed\", endurance)
		
func set_max_stamina(value):
	max_stamina = value
	emit_signal(\"max_stamina_changed\", max_stamina)
	
func set_stamina(value):
	stamina = value
	stamina = clamp(value, -30, max_stamina)
	emit_signal(\"stamina_changed\", stamina)
	
func set_strength(value):
	strength = value
	emit_signal(\"strength_changed\", strength)
	
#func set_strength_mod(value):
#	strength_mod = value
#	emit_signal(\"strength_mod_changed\", strength_mod)

func set_dexterity(value):
	dexterity = value
	emit_signal(\"dexterity_changed\", dexterity)

func set_defense(value):
	defense = value
	emit_signal(\"defense_changed\", defense)
	
func set_defense_mod(value):
	defense_mod = value
	emit_signal(\"defense_mod_changed\", defense_mod)
	
func set_iframes(value):
	iframes = value
	emit_signal(\"iframes_changed\", iframes)
	
func set_speed(value):
	speed = value
	emit_signal(\"speed_changed\", speed)
	
func set_attack_speed(value):
	attack_speed = value
	emit_signal(\"attack_speed_changed\", attack_speed)
	
func set_max_charge(value):
	max_charge = value
	emit_signal(\"max_charge_changed\", max_charge)
	
func set_charge(value):
	charge = value
	emit_signal(\"charge_changed\", charge)
	
func set_max_charge_level(value):
	max_charge_level = value
	emit_signal(\"max_charge_level_changed\", max_charge_level)
	
func set_charge_level(value):
	charge_level = value
	emit_signal(\"charge_level_changed\", charge_level)
		
func set_max_experience(value):
	experience_required = value
	emit_signal(\"max_experience_changed\", experience_required)
	
func set_experience(value):
	experience = value
	emit_signal(\"experience_changed\", experience)
	
func set_level(value):
	level = value
	emit_signal(\"level_changed\", level)
	
func set_cash(value):
	cash = value
	emit_signal(\"cash_changed\", cash)
"

[node name="PlayerStats" type="Node"]
script = SubResource( 1 )

[node name="Poison" type="Node" parent="."]
script = ExtResource( 1 )

[node name="Timer" type="Timer" parent="Poison"]
wait_time = 0.2
one_shot = true

[node name="Frenzy" type="Node" parent="."]
script = ExtResource( 2 )

[node name="Timer" type="Timer" parent="Frenzy"]
one_shot = true
[connection signal="timeout" from="Poison/Timer" to="Poison" method="_on_Timer_timeout"]
[connection signal="timeout" from="Frenzy/Timer" to="Frenzy" method="_on_Timer_timeout"]
